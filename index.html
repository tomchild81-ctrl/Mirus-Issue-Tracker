<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirus Aircraft Seating Issue Tracker</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Load Custom Stylesheet -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen">

    <!-- REVERTED: Main  app is now vi sible by default -->
    <div id="app" class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        
        <!-- NEW: Logo Header -->
        <div class="mb-6">
            <!-- 
                FIXED: The previous path "M:\..." was a local file.
                Replaced it with a public URLto your company's logo
                so that all users can see it.
            -->
            <img src="https://miruseating.com/wp-content/themes/mirus/images/logo.svg" alt="Mirus Aircraft Seating Logo" class="h-10 w-auto">
        </div>
        
        <!-- Tab Navigation -->
        <div id="tab-navigation" class="flex border-b border-gray-300 mb-8">
            <!-- CLEANUP: Removed inline onclick handlers -->
            <button id="tab-form" class="tab-button py-3 px-6 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:border-mustard-border hover:text-mustard-text transition duration-150">
                Log New Issue
            </button>
            <button id="tab-board" class="tab-button py-3 px-6 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:border-mustard-border hover:text-mustard-text transition duration-150">
                Live Tracking Board
            </button>
            <button id="tab-metrics" class="tab-button py-3 px-6 text-base font-semibold border-b-2 border-transparent text-gray-500 hover:border-mustard-border hover:text-mustard-text transition duration-150">
                Metrics
            </button>
            <!-- REVERTED: Removed Logout Button -->
        </div>

        <!-- Form View (Default) -->
        <div id="form-view" class="hidden">
            <div class="max-w-4xl mx-auto"> <!-- Center the form -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold mb-6 mustard-text">Log New Issue</h2>
                    <form id="issue-form" class="space-y-4">
                        <!-- Loading/Error Message Box -->
                        <div id="message-box" class="hidden p-4 rounded-lg shadow-md border-l-4 border-mustard-border bg-yellow-50 text-yellow-800" role="alert">
                            <p id="message-text" class="font-semibold"></p>
                        </div>

                        <!-- Reporter and Log Date -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="reporterName" class="block text-sm font-medium text-gray-700">Reporter Name</label>
                                <!-- REVERTED: Removed readOnly and bg-gray-100 -->
                                <input type="text" id="reporterName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                            <div>
                                <label for="loggedDate" class="block text-sm font-medium text-gray-700">Date Logged</label>
                                <input type="date" id="loggedDate" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            </div>
                        </div>

                        <!-- Severity and Owner -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="severity" class="block text-sm font-medium text-gray-700">Severity</label>
                                <select id="severity" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                    <option value="" disabled selected>Select Severity</option>
                                    <option value="Critical" class="text-red-600 font-semibold">Critical</option>
                                    <option value="High" class="text-orange-500 font-semibold">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                            </div>
                            <div>
                                <label for="owner" class="block text-sm font-medium text-gray-700">Problem Owner</label>
                                <input type="text" id="owner" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="assigned owner/team">
                            </div>
                        </div>

                        <!-- Department and Project -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="department" class="block text-sm font-medium text-gray-700">Department</label>
                                <select id="department" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                    <option value="" disabled selected>Select Department</option>
                                    <option value="Design">Design</option>
                                    <option value="Engineering">Engineering</option>
                                    <!-- UPDATED: Changed Manufacturing to Production -->
                                    <option value="Production">Production</option>
                                    <option value="Quality Assurance">Quality Assurance</option>
                                    <option value="Supply Chain">Supply Chain</option>
                                    <option value="Finance">Finance</option>
                                    <option value="Sales">Sales</option>
                                    <!-- ADDED: New department option -->
                                    <option value="Stores">Stores</option>
                                </select>
                            </div>
                            <div>
                                <label for="project" class="block text-sm font-medium text-gray-700">Project / Seat Type</label>
                                <input type="text" id="project" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g., Kestrel, MH20-XXX-XXXYYY">
                            </div>
                        </div>

                        <!-- Part Numbers -->
                        <div>
                            <label for="partNumbers" class="block text-sm font-medium text-gray-700">Relevant Part Numbers</label>
                            <input type="text" id="partNumbers" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g., MP-006203-100, Z01-0525-31 (comma separated)">
                        </div>

                        <!-- Issue Summary (NEW FIELD) -->
                        <div>
                            <label for="issueSummary" class="block text-sm font-medium text-gray-700">Issue Summary (50 characters max)</label>
                            <input type="text" id="issueSummary" required maxlength="50" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="Brief, urgent description of the issue.">
                        </div>

                        <!-- Description -->
                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700">Detailed Issue Description</label>
                            <textarea id="description" rows="3" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="Provide clear details on what, where, and when the issue occurred."></textarea>
                        </div>

                        <!-- Attachments (Simulated) -->
                        <div>
                            <!-- UPDATED: Removed "(Simulated Upload)" -->
                            <label for="attachments" class="block text-sm font-medium text-gray-700">Photos / Videos</label>
                            <input type="file" id="attachments" multiple accept="image/*,video/*" class="mt-1 block w-full text-sm text-gray-500
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-full file:border-0
                                file:text-sm file:font-semibold
                                file:bg-amber-50 file:mustard-text
                                hover:file:bg-amber-100"
                            >
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" id="submit-button" class="w-full py-3 px-4 border border-transparent rounded-lg shadow-md text-sm font-medium text-white mustard-bg hover:bg-amber-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition duration-150">
                            Log Issue
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Metrics View -->
        <div id="metrics-view" class="hidden">
            <div class="max-w-4xl mx-auto"> <!-- Centered, slightly wider -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold mb-4 mustard-text">Production Metrics</h2>
                    <!-- UPDATED: Grid now 1-col on mobile, 2-col on desktop -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                        <div class="p-3 bg-gray-100 rounded-lg">
                            <p id="metric-total" class="text-3xl font-bold mustard-text">0</p>
                            <p class="text-sm text-gray-500">Total Issues Logged</p>
                        </div>
                        <div class="p-3 bg-gray-100 rounded-lg">
                            <p id="metric-high" class="text-3xl font-bold text-red-600">0</p>
                            <p class="text-sm text-gray-500">High Severity (Crit/High)</p>
                        </div>
                        
                        <!-- NEW: Issues Resolved Metric -->
                        <div class="p-3 bg-gray-100 rounded-lg">
                            <p id="metric-resolved" class="text-3xl font-bold text-green-600">0</p>
                            <p class="text-sm text-gray-500">Total Issues Resolved</p>
                        </div>
                        
                        <!-- NEW: Avg. Time to Resolution Metric -->
                        <div class="p-3 bg-gray-100 rounded-lg">
                            <p id="metric-mttc" class="text-3xl font-bold text-blue-600">N/A</p>
                            <p class="text-sm text-gray-500">Avg. Time to Resolution</p>
                        </div>

                        <div class="col-span-1 md:col-span-2 mt-4">
                            <p class="text-xs text-gray-400">Data updates in real-time.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Issue List Container (Board View) -->
        <div id="board-view" class="hidden">
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h1 class="text-2xl font-bold mb-6 text-gray-800">Live Issue Tracking Board</h1>
                
                <!-- CONTROL PANEL: Filter, Sort, Search -->
                <div class="mb-6 p-4 border rounded-lg bg-gray-50">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
                        <!-- Search Input -->
                        <div class="col-span-1 md:col-span-2">
                            <label for="search-input" class="block text-xs font-medium text-gray-700 mb-1">Search (Summary/Description)</label>
                            <!-- CLEANUP: Removed inline oninput handler -->
                            <input type="text" id="search-input" placeholder="Search issues..." 
                                class="w-full rounded-md border-gray-300 shadow-sm p-2 text-sm border">
                        </div>

                        <!-- Filter by Status -->
                        <div>
                            <!-- FIXED: Corrected 'class_label' to 'class' -->
                            <label for="filter-status" class="block text-xs font-medium text-gray-700 mb-1">Filter by Status</label>
                            <!-- CLEANUP: Removed inline onchange handler -->
                            <select id="filter-status" 
                                class="w-full rounded-md border-gray-300 shadow-sm p-2 text-sm border">
                                <option value="All">All Statuses</option>
                                <option value="New">New</option>
                                <option value="In Progress">In Progress</option>
                                <option value="On Hold">On Hold</option>
                                <option value="Resolved">Resolved</option>
                            </select>
                        </div>

                        <!-- Sort By -->
                        <div>
                            <label for="sort-by" class="block text-xs font-medium text-gray-700 mb-1">Sort By</label>
                            <!-- CLEANUP: Removed inline onchange handler -->
                            <select id="sort-by" 
                                class="w-full rounded-md border-gray-300 shadow-sm p-2 text-sm border">
                                <option value="createdAt_desc">Newest First</option>
                                <option value="createdAt_asc">Oldest First</option>
                                <option value="priority_desc">Highest Priority</option>
                                <option value="lastCommentedAt_desc">Most Recently Commented</option>
                            </select>
                        </div>
                        
                        <!-- Count Display -->
                         <div class="flex items-end justify-end">
                            <p class="text-sm font-medium text-gray-600 mb-1">
                                Showing <span id="issue-count" class="font-bold mustard-text">0</span> issues
                            </p>
                        </div>
                    </div>
                </div>


                <div class="issue-list space-y-4 max-h-[70vh] overflow-y-auto pr-2" id="issue-list-container">
                    <!-- Issues will be dynamically inserted here -->
                    <p id="loading-text" class="text-center text-gray-500 italic">Loading issues...</p>
                </div>
                
                <div id="no-issues" class="hidden text-center text-gray-500 py-10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 mustard-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">No Issues Found</h3>
                    <p class="mt-1 text-sm text-gray-500">Get started by logging the first production issue using the form.</p>
                </div>
            </div>
        </div>

    </div>

    <!-- MODAL DIALOG for Issue Details and Comments -->
    <div id="issue-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <!-- CLEANUP: Added id="modal-overlay" -->
            <div id="modal-overlay" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

            <!-- Modal Content -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                            <div class="flex justify-between items-center border-b pb-3 mb-4">
                                <h3 class="text-2xl leading-6 font-bold text-gray-900" id="modal-summary">Issue Summary Loading...</h3>
                                <!-- CLEANUP: Added id="modal-close-button" -->
                                <button id="modal-close-button" class="text-gray-400 hover:text-gray-600 transition duration-150">
                                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>

                            <div class="space-y-4">
                                <!-- Severity & Status Controls -->
                                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center text-sm bg-gray-50 p-3 rounded-lg border">
                                    <div class="flex items-center space-x-4 mb-2 sm:mb-0">
                                        <!-- Severity Display -->
                                        <div>
                                            <p class="text-xs text-gray-500">Severity</p>
                                            <span id="modal-severity" class="px-3 py-1 text-xs font-bold rounded-full"></span>
                                        </div>
                                        
                                        <!-- Status Dropdown -->
                                        <div class="ml-4">
                                            <label for="modal-status-select" class="text-xs text-gray-500 block mb-0.5 font-medium">Status</label>
                                            <!-- CLEANUP: Removed inline onchange handler -->
                                            <select id="modal-status-select" 
                                                    class="p-1 border text-sm rounded-md focus:ring-amber-500 focus:border-amber-500 transition duration-150">
                                                <option value="New">New</option>
                                                <option value="In Progress">In Progress</option>
                                                <option value="On Hold">On Hold</option>
                                                <option value="Resolved">Resolved</option>
                                            </select>
                                        </div>
                                    </div>
                                    <p class="text-gray-500 text-xs sm:text-sm">Logged on: <span id="modal-logged-date" class="font-semibold text-gray-700"></span></p>
                                </div>
                                
                                <!-- Part Numbers & Project -->
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm bg-gray-50 p-3 rounded-lg">
                                    <div>
                                        <p class="text-gray-500">Project / Seat Type</p>
                                        <p class="font-semibold text-gray-800" id="modal-project"></p>
                                    </div>
                                    <div>
                                        <p class="text-gray-500">Relevant Part Numbers</p>
                                        <p class="font-semibold text-gray-800" id="modal-parts"></p>
                                    </div>
                                </div>

                                <!-- Detailed Description -->
                                <div>
                                    <h4 class="font-semibold text-gray-700 mb-1 border-b pb-1 mustard-text">Detailed Description</h4>
                                    <p class="text-gray-600 text-sm" id="modal-description"></p>
                                </div>

                                <!-- Metadata -->
                                <div class="grid grid-cols-2 gap-4 text-xs">
                                    <div>
                                        <p class="text-gray-500">Problem Owner</p>
                                        <p class="font-medium text-gray-800" id="modal-owner"></p>
                                    </div>
                                    <div>
                                        <p class="text-gray-500">Department</p>
                                        <p class="font-medium text-gray-800" id="modal-department"></p>
                                    </div>
                                    <div>
                                        <p class="text-gray-500">Reported By</p>
                                        <p class="font-medium text-gray-800" id="modal-reporter"></p>
                                    </div>
                                    <div>
                                        <p class="text-gray-500">Attachments</p>
                                        <!-- UPDATED: This is now a div to hold either text or an image -->
                                        <div id="modal-attachments">
                                            <p class="font-medium text-gray-800">None</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- COMMENTS SECTION -->
                                <div class="mt-6 border-t pt-4">
                                    <h4 class="font-semibold text-gray-700 mb-2 border-b pb-1 mustard-text">Comments</h4>
                                    <div id="comments-list" class="comments-list max-h-48 overflow-y-auto space-y-3 p-2 bg-gray-50 rounded-lg border">
                                        <!-- Comments will load here -->
                                        <p id="no-comments" class="text-sm text-gray-500 text-center">No comments yet.</p>
                                    </div>
                                    
                                    <!-- Comment Submission Form -->
                                    <form id="comment-form" class="mt-4 p-3 bg-white border rounded-lg shadow-inner">
                                        <input type="hidden" id="current-issue-id">
                                        <!-- REVERTED: Removed readOnly and bg-gray-100 -->
                                        <input type="text" id="commenter-name" placeholder="Your Name" required class="w-full text-sm p-2 mb-2 border rounded-md">
                                        <textarea id="comment-text" rows="2" placeholder="Add a comment..." required class="w-full text-sm p-2 border rounded-md"></textarea>
                                        <button type="submit" id="post-comment-button" class="w-full py-2 text-sm font-medium rounded-lg text-white mustard-bg hover:bg-amber-600 transition">Post Comment</button>
                                    </form>
                                </div>
                                
                                <p class="text-xs text-gray-400 pt-2 border-t mt-4">System ID: <span id="modal-user-id"></span> | Database Ref: <span id="modal-doc-id"></span></p>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Firebase SDKs -->
    <!-- UPDATED: All inline code has been moved to app.js -->
    <script type="module" src="app.js"></script>
    
</body>

</html>


